jobs:
  cta_transition:
    if: (github.actor == 'JoshuaKGoldberg' || github.actor == 'renovate[bot]') && contains(github.event.pull_request.title, 'create-typescript-app') && startsWith(github.head_ref, 'renovate/')
    name: Run CTA Transition Mode
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6
        with:
          fetch-depth: 0
          ref: ${{github.head_ref}}
          repository: ${{github.event.pull_request.head.repo.full_name}}
          token: "${{ secrets.ACCESS_TOKEN }}"
      - uses: ./.github/actions/prepare
      - run: npx create-typescript-app
      - run: git status
      - run: git diff HEAD
      - uses: stefanzweifel/git-auto-commit-action@28e16e81777b558cc906c8750092100bbb34c5e3 # v7
        with:
          commit_author: "The Friendly Bingo Bot <bot@create.bingo>"
          commit_message: "Check in changes from re-running npx create-typescript-app"
          commit_user_email: "bot@create.bingo"
          commit_user_name: "The Friendly Bingo Bot"
      - uses: mshick/add-pr-comment@b8f338c590a895d50bcbfa6c5859251edc8952fc # v2
        with:
          issue: ${{ github.event.pull_request.number }}
          message: |
            ü§ñ Beep boop! I ran `npx create-typescript-app` and found code changes.
            I've gone ahead and committed them to this PR branch for you. Please review the latest commit to see if you want to merge it.
            Cheers! üíù
          repo-token: "${{ secrets.ACCESS_TOKEN }}"

name: CTA Transitions

on:
  pull_request_target:
    branches:
      - main
